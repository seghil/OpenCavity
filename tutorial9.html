<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial 9 - Fresnel propagation module &mdash; OpenCavity 0.1 Pre-Alpha documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1 Pre-Alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenCavity 0.1 Pre-Alpha documentation" href="index.html" />
    <link rel="prev" title="Tutorial 8 - 2D cavity with masks" href="tutorial8.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial8.html" title="Tutorial 8 - 2D cavity with masks"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">OpenCavity 0.1 Pre-Alpha documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial-9-fresnel-propagation-module">
<span id="tuto9-label"></span><h1>Tutorial 9 - Fresnel propagation module<a class="headerlink" href="#tutorial-9-fresnel-propagation-module" title="Permalink to this headline">¶</a></h1>
<p>In some of the previous tutorials we used the Fresnel propagation module that comes with OpenCavity, mainly to calculate the output beam for
1d and 2D cavity systems. And also with Bessel-Gauss cavities to show how the Bessel beams propagate especially in their non-diffracting region.
In this tutorial  we use the Fresnel propagation module to do beam transforming using a phase function as it is usually realized practically
using phase-plates and diffractive elements  or spatial light modulators (SLMs) to transform the phase structure of a given beam.</p>
<p>First we generate a fundamental Gaussian beam using Hermite-Gauss beams generator (HgBasis function) then we see how to transform it  to a
donut-shaped one also known as vortex-beam using a phase mask. This beam  has a helical wavefront rather than parallel one as in fundamental
Gaussian beams as we have already seen.
In the second part of the tutorial we design a Mach-Zehnder interferometer to see the phase singularity of the donut beam, and understand
better why it is called a vortex. The objective of this tutorial is to become familiar with:</p>
<ul class="simple">
<li>Beam generator module</li>
<li>Fresnel propagator and use phase masks in addition to paraxial elements</li>
<li>Superimpose and move beams on  detectors surface to get interference result.</li>
</ul>
<p>First of all let&#8217;s generate the Gaussian beam we are going to use through this tutorial, for this we use the function <code class="docutils literal"><span class="pre">generate_gh(n,m,x,y,z)</span></code>
that returns  the E-field of Hermite-Gauss beam of order <cite>n,m</cite> at coordinates (x,y,z). We can use this function in a quite flexible way, for
example to generate 1D beam profile by giving it an 1D array  along one spatial axis (x ,y or z) and 2 constants for the remaining ones .
Or by giving it 2D mesh-grids to construct 2D intensity profile HG beams at a given <a href="#id1"><span class="problematic" id="id2">`</span></a>z`coordinate as in this tutorial.</p>
<p>the function is located in  <code class="docutils literal"><span class="pre">HgBasis</span></code> class in``beams`` module, this class holds properties common to all the beams of the basis set.
As always we start by importing modules we need.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">opencavity.beams</span> <span class="kn">import</span> <span class="n">HgBasis</span>

<span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">opencavity.propagators</span> <span class="kn">import</span> <span class="n">FresnelProp</span>

<span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="gp">In [4]: </span><span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="gp">In [5]: </span><span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
<p>Then we generate a fundamental Gaussian beam (n=m=0) at wavelength =1 and waist =100 (in wavelength unit say microns for example).</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [6]: </span><span class="n">waist</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">waist_x</span><span class="o">=</span><span class="n">waist</span><span class="p">;</span> <span class="n">waist_y</span><span class="o">=</span><span class="n">waist</span><span class="p">;</span> <span class="n">wavelength</span><span class="o">=</span><span class="mi">1</span>

<span class="gp">In [7]: </span><span class="n">H</span><span class="o">=</span><span class="n">HgBasis</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span><span class="n">waist_x</span><span class="p">,</span><span class="n">waist_y</span><span class="p">)</span> <span class="c">#creating the Hermite-Gauss basis with initial waist equals to 100 microns</span>

<span class="gp">In [8]: </span><span class="n">z</span><span class="o">=</span><span class="mf">0.000000000000000001</span> <span class="c">#(z=0, small value rather than &#39;0&#39; to prevent division by 0)</span>

<span class="gp">In [9]: </span><span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="gp">In [10]: </span><span class="n">H</span><span class="o">=</span><span class="n">HgBasis</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">waist_x</span><span class="p">,</span><span class="n">waist_y</span><span class="p">)</span> <span class="c">#creating the Hermite-Gauss basis with initial waist equals to 100 microns</span>

<span class="gp">In [11]: </span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">waist</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">waist</span><span class="p">,</span><span class="mi">80</span><span class="p">);</span> <span class="n">y</span><span class="o">=</span><span class="n">x</span> <span class="c"># two 1D vectors</span>

<span class="gp">In [12]: </span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="c"># we use numerical python &#39;np&#39; to generate a 2D meshgrid.</span>

<span class="gp">In [13]: </span><span class="n">tem00</span><span class="o">=</span><span class="n">H</span><span class="o">.</span><span class="n">generate_hg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="c"># generate TEM00 mode</span>

<span class="gp">In [14]: </span><span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tem00</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="s">&#39;hot&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">();</span> <span class="c"># 2D plot/ colormap /colorbar</span>

<span class="gp">In [15]: </span><span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">tem00</span><span class="p">));</span> <span class="c"># phase map</span>

<span class="gp">In [16]: </span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto9_plot_HG00_E.png"><img alt="_images/tuto9_plot_HG00_E.png" src="_images/tuto9_plot_HG00_E.png" style="width: 4.5in;" /></a>
<a class="reference internal image-reference" href="_images/tuto9_plot_HG00_P.png"><img alt="_images/tuto9_plot_HG00_P.png" src="_images/tuto9_plot_HG00_P.png" style="width: 4.5in;" /></a>
<p>Now we want to transform this beam to a donut-shaped one, for this we need a helical phase mask (phase-plate of SLM), this phase mask has the function
<span class="math">\(phase(x,y)=atan(y/x)+\frac{1-sign(x)}{2}\)</span>. Obviously one have to manage the special case of <cite>x=0</cite> which gives three cases:</p>
<div class="math">
\[\begin{split}y&lt;0 , \phi=\frac{3 2\pi}{4} \\
y&gt;0 , \phi=\frac{1 2\pi}{4} \\
y=0 , \phi=2\pi\end{split}\]</div>
<p>In third case (x=y=0) we have a singular point(the phase is not defined) but let&#8217;s just take 2 pi), it is important to note that the mask phase we are making acts as a
phase plate (add a certain amount to the beam phase) so just as we have seen with lenses its function takes the form <span class="math">\(exp(j\times phase(x,y))\)</span>. Indeed, in numerical
python <code class="docutils literal"><span class="pre">np</span></code> we can use <code class="docutils literal"><span class="pre">arctan2(y,x)</span></code> an element-wise arc tangent function that choose the quadrant correctly.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [17]: </span><span class="n">n</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">size</span>  <span class="c"># size of the array &#39;x&#39;</span>

<span class="gp">In [18]: </span><span class="n">phase</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span><span class="o">+</span><span class="mi">1j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

<span class="gp">In [19]: </span><span class="n">m</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="gp">In [20]: </span><span class="k">for</span> <span class="n">kx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="gp">   ....:</span>    <span class="k">for</span> <span class="n">ky</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="gp">   ....:</span>       <span class="n">phase</span><span class="p">[</span><span class="n">kx</span><span class="p">,</span><span class="n">ky</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ky</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">kx</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<span class="gp">   ....:</span> 
</pre></div>
</div>
<p>In third case (x=y=0) we have a singular point(the phase is not defined) but let&#8217;s just take 2 pi), it is important to note that the mask phase we are making acts as a phase plate (add a certain amount to the beam phase) so just alike we have seen with lenses its function takes the form :math: <cite>exp(jtimes phase(x,y))</cite>.</p>
<p>We consider the beam we generated is a collimated one (plane wavefront) to transform it we just multiply it by the phase function and propagate it using <code class="docutils literal"><span class="pre">FresnelProp</span></code> following
the steps we sown in previous tutorials:</p>
<ul class="simple">
<li>create the paraxial propagation matrix of the propagation system.</li>
<li>create a propagator object</li>
<li>set the initial beam and the propagation matrix in the propagator</li>
<li>do 1D/2D propagation using <code class="docutils literal"><span class="pre">propagate1D_ABCD(x2)</span></code>/<code class="docutils literal"><span class="pre">propagate2D_ABCD(x2,y2)</span></code> function.</li>
</ul>
<p>Where (x2,y2) are vectors defining the propagation plane (result) that one can consider as the detector surface.</p>
<p>Before starting to that let&#8217;s take a look at the interferometer.</p>
<a class="reference internal image-reference" href="_images/schema_interfero_donut.png"><img alt="_images/schema_interfero_donut.png" class="align-center" src="_images/schema_interfero_donut.png" style="width: 6.5in;" /></a>
<p>The goal here is to propagate to have to have two different optical paths and therefor two versions of the beam having different radius of
curvature of the wavefront on the detector.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [21]: </span><span class="n">L1</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">L2</span><span class="o">=</span><span class="mf">190e3</span><span class="p">;</span> <span class="n">L3</span><span class="o">=</span><span class="mf">120e3</span><span class="p">;</span> <span class="n">L4</span><span class="o">=</span><span class="mf">140e3</span><span class="p">;</span>

<span class="gp">In [22]: </span><span class="n">f1</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">f2</span><span class="o">=</span><span class="mf">60e3</span><span class="p">;</span> <span class="c">#converging lens FL1=50mm, FL2=60mm</span>
</pre></div>
</div>
<p>ABCD matrix of interferometer&#8217;s first arm</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [23]: </span><span class="n">M1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [24]: </span><span class="n">M2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">f1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [25]: </span><span class="n">M3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [26]: </span><span class="n">M4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">f2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [27]: </span><span class="n">M5</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [28]: </span><span class="n">M_arm1</span><span class="o">=</span><span class="n">M5</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M4</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M3</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span> <span class="c"># calculating the global matrix</span>
</pre></div>
</div>
<p>ABCD matrix of interferometer&#8217;s second arm</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [29]: </span><span class="n">M1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [30]: </span><span class="n">M6</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L2</span><span class="o">+</span><span class="n">L3</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">L4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [31]: </span><span class="n">M_arm2</span><span class="o">=</span><span class="n">M6</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span>
</pre></div>
</div>
<p>Creating the first optical system (arm 1) and propagate the initial beam through it.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [32]: </span><span class="n">opsys1</span><span class="o">=</span><span class="n">FresnelProp</span><span class="p">()</span> <span class="c"># optical system 1</span>

<span class="gp">In [33]: </span><span class="n">opsys1</span><span class="o">.</span><span class="n">set_start_beam</span><span class="p">(</span><span class="n">tem00</span><span class="o">*</span><span class="n">phase</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="c"># note that the initial beam is multiplied by the phase function we created earlier.</span>
<span class="go">2D initial beam but y1 is missing..</span>
<span class="go">y1 is set = x1.</span>

<span class="gp">In [34]: </span><span class="n">opsys1</span><span class="o">.</span><span class="n">set_ABCD</span><span class="p">(</span><span class="n">M_arm1</span><span class="p">);</span> <span class="n">x2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">;</span> <span class="n">y2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">y</span><span class="p">;</span> <span class="c"># set the propagation matrix</span>

<span class="gp">In [35]: </span><span class="n">opsys1</span><span class="o">.</span><span class="n">propagate2D_ABCD</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="c"># propagation</span>
<span class="go">calculating Fresnel propagation...</span>

<span class="gp">In [36]: </span><span class="n">opsys1</span><span class="o">.</span><span class="n">show_result_beam</span><span class="p">(</span><span class="s">&#39;intensity&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="gp">In [37]: </span><span class="n">opsys1</span><span class="o">.</span><span class="n">show_result_beam</span><span class="p">(</span><span class="s">&#39;phase&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto9_plot_arm1_I.png"><img alt="_images/tuto9_plot_arm1_I.png" src="_images/tuto9_plot_arm1_I.png" style="width: 4.5in;" /></a>
<a class="reference internal image-reference" href="_images/tuto9_plot_arm1_P1.png"><img alt="_images/tuto9_plot_arm1_P1.png" src="_images/tuto9_plot_arm1_P1.png" style="width: 4.5in;" /></a>
<p>Creating the first optical system (arm 2) and propagate the initial beam through it.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [38]: </span><span class="n">opsys2</span><span class="o">=</span><span class="n">FresnelProp</span><span class="p">()</span> <span class="c"># optical system 1</span>

<span class="gp">In [39]: </span><span class="n">opsys2</span><span class="o">.</span><span class="n">set_start_beam</span><span class="p">(</span><span class="n">tem00</span><span class="o">*</span><span class="n">phase</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="c"># note that the initial beam is multiplied by the phase function we created earlier.</span>
<span class="go">2D initial beam but y1 is missing..</span>
<span class="go">y1 is set = x1.</span>

<span class="gp">In [40]: </span><span class="n">opsys2</span><span class="o">.</span><span class="n">set_ABCD</span><span class="p">(</span><span class="n">M_arm2</span><span class="p">);</span> <span class="n">x2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">;</span> <span class="n">y2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">y</span><span class="p">;</span> <span class="c"># set the propagation matrix</span>

<span class="gp">In [41]: </span><span class="n">opsys2</span><span class="o">.</span><span class="n">propagate2D_ABCD</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="n">y2</span><span class="o">-</span><span class="mi">600</span><span class="p">)</span> <span class="c"># propagation with small decenter (500 and 600 microns)</span>
<span class="go">calculating Fresnel propagation...</span>

<span class="gp">In [42]: </span><span class="n">opsys2</span><span class="o">.</span><span class="n">show_result_beam</span><span class="p">(</span><span class="s">&#39;intensity&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="gp">In [43]: </span><span class="n">opsys2</span><span class="o">.</span><span class="n">show_result_beam</span><span class="p">(</span><span class="s">&#39;phase&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto9_plot_arm2_I.png"><img alt="_images/tuto9_plot_arm2_I.png" src="_images/tuto9_plot_arm2_I.png" style="width: 4.5in;" /></a>
<a class="reference internal image-reference" href="_images/tuto9_plot_arm2_P.png"><img alt="_images/tuto9_plot_arm2_P.png" src="_images/tuto9_plot_arm2_P.png" style="width: 4.5in;" /></a>
<p>The optical system is an object holding all informations needed for  the propagation, for example</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">opsys.U1</span></code>,``opsys.x1``,``opsys.y1`` are the initial beam E-field and coordinates of its plane.</li>
<li><code class="docutils literal"><span class="pre">opsys.U2</span></code>,``opsys.x2``,``opsys.y2`` are the result beam E-field and coordinates of its plane.</li>
</ul>
</div></blockquote>
<p>You can see the class documentation for more informations, for the time being let&#8217;s stay with these two members (U1, U2). when the
function <code class="docutils literal"><span class="pre">opsys.show_result_beam()</span></code> it merely plots the amplitude of <code class="docutils literal"><span class="pre">opsys.U2</span></code>. Now we want to see the interference of the two
beams (arm 1 and arm 2), to do this we have to sum the propagation result of <code class="docutils literal"><span class="pre">opsys1.U2</span></code> and <code class="docutils literal"><span class="pre">opsys2.U2</span></code></p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [44]: </span><span class="n">inter</span><span class="o">=</span><span class="mf">0.4</span><span class="o">*</span><span class="n">opsys1</span><span class="o">.</span><span class="n">U2</span><span class="o">+</span><span class="n">opsys2</span><span class="o">.</span><span class="n">U2</span>

<span class="gp">In [45]: </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gr">Out[45]: </span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span> <span class="n">at</span> <span class="mh">0x51216828</span><span class="o">&gt;</span>

<span class="gp">In [46]: </span><span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c"># plots the intensity of the interference.</span>
<span class="gr">Out[46]: </span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PolyCollection</span> <span class="n">at</span> <span class="mh">0x5448c518</span><span class="o">&gt;</span>

<span class="gp">In [47]: </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto9_plot_interference_I1.png"><img alt="_images/tuto9_plot_interference_I1.png" src="_images/tuto9_plot_interference_I1.png" style="width: 4.5in;" /></a>
<div class="section" id="the-cleaned-code">
<h2>The cleaned code<a class="headerlink" href="#the-cleaned-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">@author: M.seghilani</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">opencavity.beams</span> <span class="kn">import</span> <span class="n">HgBasis</span>
<span class="kn">from</span> <span class="nn">opencavity.propagators</span> <span class="kn">import</span> <span class="n">FresnelProp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">waist</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">waist_x</span><span class="o">=</span><span class="n">waist</span><span class="p">;</span> <span class="n">waist_y</span><span class="o">=</span><span class="n">waist</span><span class="p">;</span>
<span class="n">H</span><span class="o">=</span><span class="n">HgBasis</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">waist_x</span><span class="p">,</span><span class="n">waist_y</span><span class="p">)</span> <span class="c">#creating the Hermite-Gauss basis with initial waist equals to 100 microns</span>
<span class="n">z</span><span class="o">=</span><span class="mf">0.000000000000000001</span>

<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">waist</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">waist</span><span class="p">,</span><span class="mi">80</span><span class="p">);</span> <span class="n">y</span><span class="o">=</span><span class="n">x</span>
<span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">tem00</span><span class="o">=</span><span class="n">H</span><span class="o">.</span><span class="n">generate_hg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="c"># generate TEM00 mode </span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tem00</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="s">&#39;hot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">n</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">size</span>
<span class="n">phase</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span><span class="o">+</span><span class="mi">1j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="n">m</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="k">for</span> <span class="n">kx</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ky</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">phase</span><span class="p">[</span><span class="n">kx</span><span class="p">,</span><span class="n">ky</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ky</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">kx</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
         

<span class="c"># create an ABCD matrix to propagate the beam </span>
<span class="n">L1</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span><span class="c"># mm</span>
<span class="n">f1</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="c">#mm converging lens FL</span>
<span class="n">L2</span><span class="o">=</span><span class="mf">190e3</span><span class="p">;</span><span class="c"># mm</span>
<span class="n">f2</span><span class="o">=</span><span class="mf">60e3</span><span class="p">;</span>
<span class="n">L3</span><span class="o">=</span><span class="mf">120e3</span><span class="p">;</span>
<span class="n">L4</span><span class="o">=</span><span class="mf">140e3</span><span class="p">;</span>

<span class="c">#  definition of the ABCD matrices  </span>
<span class="c">#first interfero arm   </span>
<span class="n">M1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span> 
<span class="n">M2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">f1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>
<span class="n">M3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>
<span class="n">M4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">f2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>
<span class="n">M5</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>
<span class="n">M_arm1</span><span class="o">=</span><span class="n">M5</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M4</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M3</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span> <span class="c"># calculating the global matrix </span>

<span class="c">#second interfero arm</span>
<span class="c"># L2=140e3+140e3+170e3+140e3;</span>
<span class="n">M1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span> 
<span class="n">M2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">f1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>
<span class="n">M6</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L2</span><span class="o">+</span><span class="n">L3</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">L4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>
<span class="n">M_arm2</span><span class="o">=</span><span class="n">M6</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span>


<span class="n">opsys1</span><span class="o">=</span><span class="n">FresnelProp</span><span class="p">()</span>
<span class="n">opsys1</span><span class="o">.</span><span class="n">set_start_beam</span><span class="p">(</span><span class="n">tem00</span><span class="o">*</span><span class="n">phase</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">opsys1</span><span class="o">.</span><span class="n">set_ABCD</span><span class="p">(</span><span class="n">M_arm1</span><span class="p">);</span> <span class="n">x2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">;</span> <span class="n">y2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">y</span><span class="p">;</span>
<span class="n">opsys1</span><span class="o">.</span><span class="n">propagate2D_ABCD</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
<span class="n">opsys1</span><span class="o">.</span><span class="n">show_result_beam</span><span class="p">()</span>
<span class="c">#opsys1.show_result_beam(what=&#39;phase&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">opsys2</span><span class="o">=</span><span class="n">FresnelProp</span><span class="p">()</span>
<span class="n">opsys2</span><span class="o">.</span><span class="n">set_start_beam</span><span class="p">(</span><span class="n">tem00</span><span class="o">*</span><span class="n">phase</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">opsys2</span><span class="o">.</span><span class="n">set_ABCD</span><span class="p">(</span><span class="n">M_arm2</span><span class="p">);</span> <span class="n">x2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">;</span> <span class="n">y2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">y</span><span class="p">;</span>
<span class="n">opsys2</span><span class="o">.</span><span class="n">propagate2D_ABCD</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="n">y2</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="n">opsys2</span><span class="o">.</span><span class="n">show_result_beam</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>
<span class="c">#opsys2.show_result_beam(what=&#39;phase&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">inter</span><span class="o">=</span><span class="mf">0.4</span><span class="o">*</span><span class="n">opsys1</span><span class="o">.</span><span class="n">U2</span><span class="o">+</span><span class="n">opsys2</span><span class="o">.</span><span class="n">U2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c"># X,Y from the meshgrid</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial 9 - Fresnel propagation module</a><ul>
<li><a class="reference internal" href="#the-cleaned-code">The cleaned code</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial8.html"
                        title="previous chapter">Tutorial 8 - 2D cavity with masks</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial9.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial8.html" title="Tutorial 8 - 2D cavity with masks"
             >previous</a> |</li>
        <li><a href="index.html">OpenCavity 0.1 Pre-Alpha documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, M.Seghilani.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
  </body>
</html>